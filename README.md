# VK PHP Framework
Фреймворк для написания ботов ВКонтакте.

## Установка
Для установки фреймворка достаточно скачать файл [vk.php](https://github.com/slmatthew/vk-php-bot/blob/master/src/vk.php).

## Инициализация
Пример:
```php
include './vk.php';

$bot = new VKBot(168041404, '8devqmftwx5cw7yg5w5v95bpgg47z6kdmj4uacybc44vrdvbb5uab8ksdd8v4h4bjb5aqzk45tyakgzhy5sg7');
```

| Параметр | Тип    | Обязательный? | По умолчанию | Описание                                              |
|----------|--------|---------------|--------------|-------------------------------------------------------|
| group_id | int    | **yes**       | _нет_        | ID сообщества, где работает бот (положительное число) |
| token    | string | **yes**       | _нет_        | `access_token`, полученный в настройках API           |
| language | string | _no_          | `ru`         | Идентификатор языка                                   |
| v        | string | _no_          | `5.95`       | Версия API                                            |

## Основные функции
### Вызов любого метода API
Пример:
```php
$bot->call('users.get', array('user_ids' => '1,2,3'));
$bot->call('users.get', ['user_ids' => 1]);
```
| Параметр | Тип    | Обязательный? | По умолчанию | Описание        |
|----------|--------|---------------|--------------|-----------------|
| m        | string | **yes**       | _нет_        | Название метода |
| p        | array  | **yes**       | `array()`    | Параметры       |

### Загрузка файла
Пример:
```php
$bot->upload('https://server.userapi.com/oaoaoa/mmm', 'myphoto.png');
```

| Параметр | Тип    | Обязательный? | По умолчанию | Описание        |
|----------|--------|---------------|--------------|-----------------|
| url      | string | **yes**       | _нет_        | Адрес загрузки  |
| file     | string | **yes**       | _нет_        | Путь к файлу    |

### Вызов метода execute
Пример:
```php
$bot->execute('return true;');
```

| Параметр | Тип    | Обязательный? | По умолчанию | Описание               |
|----------|--------|---------------|--------------|------------------------|
| code     | string | **yes**       | _нет_        | Код в формате VKScript |

### Отправка сообщения
Пример:
```php
$bot->send(1, 'Привет!', 'photo1_1,video1_1', '{"one_time": false, "buttons": []}', 228757, 1);
```

| Параметр         | Тип    | Обязательный? | По умолчанию                         | Описание                                             |
|------------------|--------|---------------|--------------------------------------|------------------------------------------------------|
| peer_id          | int    | **yes**       | _нет_                                | Идентификатор назначения                             |
| message          | string | **yes**       | _нет_                                | Текст сообщения                                      |
| attachment       | string | _no_          | Пустая строка                        | Вложения                                             |
| keyboard         | string | _no_          | `{"one_time": false, "buttons": []}` | Клавиатура                                           |
| reply_to         | int    | _no_          | `0` _(без ответа на сообщение)_      | ID сообщения, на которое отвечает бот                |
| dont_parse_links | int    | _no_          | `0`                                  | См. [документацию](https://vk.com/dev/messages.send) |

### Загрузка фотографии в сообщение
Пример:
```php
$bot->uploadPhoto('photo.png');
```

| Параметр | Тип    | Обязательный? | По умолчанию | Описание     |
|----------|--------|---------------|--------------|--------------|
| filename | string | **yes**       | _нет_        | Путь к файлу |

### Загрузка документа в сообщение
Пример:
```php
$bot->uploadDoc('document.gif');
$bot->uploadDoc('audio.mp3', 'audio_message');
```
| Параметр | Тип    | Обязательный? | По умолчанию | Описание      |
|----------|--------|---------------|--------------|---------------|
| filename | string | **yes**       | _нет_        | Путь к файлу  |
| type     | string | _no_          | `doc`        | Тип документа |

## Дополнительные функции
### Проверяем, есть ли пользователь в чате
Пример:
```php
$bot->isUserChatMember(2000000001, 2050);
$bot->isUserChatMember(2000000001, -1);
```

| Параметр  | Тип    | Обязательный? | По умолчанию | Описание                |
|-----------|--------|---------------|--------------|-------------------------|
| peer_id   | int    | **yes**       | _нет_        | Идентификатор диалога   |
| member_id | int    | **yes**       | _нет_        | Идентификатор участника |

### Проверяем, есть ли бот в чате
Пример:
```php
$bot->isBotChatMember(2000000001);
```

| Параметр | Тип | Обязательный? | По умолчанию | Описание              |
|----------|-----|---------------|--------------|-----------------------|
| peer_id  | int | **yes**       | _нет_        | Идентификатор диалога |

### Выбор текста в зависимости от пола пользователя
Пример:
```php
$bot->getTextBySex(1, "Вы указали мужской пол.", "Вы указали женский пол");
$bot->getTextBySex(1, "Вы указали мужской пол.", "Вы указали женский пол", $user['sex']);
```
| Параметр | Тип    | Обязательный? | По умолчанию             | Описание                                                  |
|----------|--------|---------------|--------------------------|-----------------------------------------------------------|
| user_id  | int    | **yes**       | _нет_                    | Идентификатор пользователя                                |
| male     | string | **yes**       | _нет_                    | Строка, которая вернётся, если пол пользователя — мужской |
| female   | string | **yes**       | _нет_                    | Строка, которая вернётся, если пол пользователя — женский |
| sex      | int    | _no_          | `-1` _(не используется)_ | Предопределённый пол (например, из переменной)            |

## Формат ответа
### Фотография
```json
{
  "response": [{
    "id": 1,
    "album_id": -3,
    "owner_id": 1,
    "sizes": [],
    "text": "",
    "date": 1551477718,
    "access_key": "key"
  }]
}
```

### Документ
```json
{
  "response": {
    "type": "doc",
    "doc": {
      "id": 1,
      "owner_id": 1,
      "title": "Document",
      "size": 500,
      "ext": "jpg",
      "url": "https://vk.com/doc1_1",
      "date": 1551477311,
      "type": 4,
      "preview": []
    }
  }
}
```

### Аудиосообщение
```json
{
  "response": {
    "type": "audio_message",
    "audio_message": {
      "id": 1,
      "owner_id": 1,
      "duration": 1,
      "waveform": [0, 0, 0, 0, 0, 0, 0],
      "link_ogg": "https://psv4.userapi.com/server/file.ogg",
      "link_mp3": "https://psv4.userapi.com/server/file.mp3",
      "access_key": "key"
    }
  }
}
```